[
  {
    "id": "class",
    "name": "Class",
    "type": "base",
    "value_type": "resource",
    "default_value": null
  },
  {
    "id": "archetype_id",
    "name": "Archetype ID",
    "type": "base",
    "value_type": "string",
    "default_value": null
  },
  {
    "id": "class_level",
    "name": "Class level",
    "type": "base",
    "value_type": "integer",
    "default_value": 1
  },
  {
    "id": "selected_selectable_feature_ids",
    "name": "Selected selectable feature ids",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "string",
    "default_value": []
  },
  {
    "id": "last_selection_level",
    "name": "Last level in which the player selected proficiencies",
    "type": "base",
    "value_type": "integer",
    "default_value": 0
  },
  {
    "id": "should_select_on_level_up",
    "name": "Should select new stuff on this level up",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "equals",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "stat",
            "stat": "$character.temp_last_level_up_class_id"
          },
          {
            "type": "stat",
            "stat": "class.id"
          }
        ]
      }
    }
  },
  {
    "id": "class_name_with_archetype",
    "name": "Class name with archetype",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "concat",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "stat",
            "stat": "class.name"
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "notNull",
                  "components": {
                    "type": "stat",
                    "stat": "class.selected_archetype"
                  }
                },
                "components": {
                  "type": "concat",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "constant",
                        "value": " (",
                        "value_type": "string"
                      },
                      {
                        "type": "stat",
                        "stat": "class.selected_archetype?.name"
                      },
                      {
                        "type": "constant",
                        "value": ")",
                        "value_type": "string"
                      }
                    ]
                  }
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "constant",
                  "value": "",
                  "value_type": "string"
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "id": "show_spellcasting_details",
    "name": "Should show spellcasting details",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "notEquals",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "stat",
            "stat": "class.actual_effective_caster_level"
          },
          {
            "type": "constant",
            "value": "zero",
            "value_type": "string"
          }
        ]
      }
    }
  },
  {
    "id": "class_name_with_spellcasting_ability",
    "name": "Class name with spellcasting ability",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "concat",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "stat",
            "stat": "class.name"
          },
          {
            "type": "constant",
            "value": " (",
            "value_type": "string"
          },
          {
            "type": "enumeratedAbbreviation",
            "enumerated_type": "ability",
            "id": {
              "type": "stat",
              "stat": "class.actual_spellcasting_ability"
            }
          },
          {
            "type": "constant",
            "value": ")",
            "value_type": "string"
          }
        ]
      }
    }
  },
  {
    "id": "spell_attack_bonus",
    "name": "Spell attack bonus",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "add",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "metaStat",
            "meta_stat": {
              "type": "concat",
              "components": {
                "type": "list",
                "components": [
                  {
                    "type": "constant",
                    "value": "$character.",
                    "value_type": "string"
                  },
                  {
                    "type": "stat",
                    "stat": "class.actual_spellcasting_ability"
                  },
                  {
                    "type": "constant",
                    "value": "_modifier",
                    "value_type": "string"
                  }
                ]
              }
            }
          },
          {
            "type": "stat",
            "stat": "$character.proficiency_bonus"
          },
          {
            "type": "stat",
            "stat": "$character.spell_attack_extra_bonus"
          }
        ]
      }
    }
  },
  {
    "id": "spell_attack_bonus_text",
    "name": "Spell attack bonus formatted",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "greaterThanEquals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "spell_attack_bonus"
                },
                {
                  "type": "constant",
                  "value": 0,
                  "value_type": "integer"
                }
              ]
            }
          },
          "components": {
            "type": "concat",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "constant",
                  "value": "+",
                  "value_type": "string"
                },
                {
                  "type": "stat",
                  "stat": "spell_attack_bonus"
                }
              ]
            }
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "spell_attack_bonus"
          }
        }
      ]
    }
  },
  {
    "id": "spell_save_dc",
    "name": "Spell save DC",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "add",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "constant",
            "value": 8,
            "value_type": "integer"
          },
          {
            "type": "metaStat",
            "meta_stat": {
              "type": "concat",
              "components": {
                "type": "list",
                "components": [
                  {
                    "type": "constant",
                    "value": "$character.",
                    "value_type": "string"
                  },
                  {
                    "type": "stat",
                    "stat": "class.actual_spellcasting_ability"
                  },
                  {
                    "type": "constant",
                    "value": "_modifier",
                    "value_type": "string"
                  }
                ]
              }
            }
          },
          {
            "type": "stat",
            "stat": "$character.proficiency_bonus"
          },
          {
            "type": "stat",
            "stat": "$character.spell_dc_extra_bonus"
          }
        ]
      }
    }
  },
  {
    "id": "attacks_per_action",
    "name": "Attacks per action",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "stat",
      "stat": "class.attacks_per_action_number_for_current_level"
    }
  },
  {
    "id": "hit_die_max",
    "name": "Hit die max",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "toNum",
      "components": {
        "type": "replace",
        "string": {
          "type": "stat",
          "stat": "class.actual_hit_die"
        },
        "occurrence": {
          "type": "constant",
          "value": "d",
          "value_type": "string"
        },
        "replace": {
          "type": "constant",
          "value": "",
          "value_type": "string"
        }
      }
    }
  },
  {
    "id": "hit_die_average",
    "name": "Hit die average",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "divide",
      "rounding_method": "up",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "add",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "constant",
                  "value": 1,
                  "value_type": "integer"
                },
                {
                  "type": "stat",
                  "stat": "hit_die_max"
                }
              ]
            }
          },
          {
            "type": "constant",
            "value": 2,
            "value_type": "integer"
          }
        ]
      }
    }
  },
  {
    "id": "should_show_level_up_disclaimer",
    "name": "Should show level up disclaimer",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "and",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "not",
            "components": {
              "type": "defaultIfNull",
              "components": {
                "type": "stat",
                "stat": "$character?.$is_new?"
              },
              "default_components": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              }
            }
          },
          {
            "type": "greaterThan",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "defaultIfNull",
                  "components": {
                    "type": "stat",
                    "stat": "$view?.class_details_edit_class_level?"
                  },
                  "default_components": {
                    "type": "constant",
                    "value": 1,
                    "value_type": "string"
                  }
                },
                {
                  "type": "stat",
                  "stat": "class_level"
                }
              ]
            }
          }
        ]
      }
    }
  },
  {
    "id": "features",
    "name": "Features",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "feat",
    "components": {
      "type": "sortBy",
      "components": {
        "type": "stat",
        "stat": "class.current_level_features"
      },
      "sort_by_selector": {
        "type": "stat",
        "stat": "$sortByValue.min_level"
      }
    }
  }
]