base string name(name = "Name") = "";

base photo photo(name = "Photo") = null;

base string source(name = "Source") = "";

base string tag(name = "Tag") = "";

base integer armor_class(name = "Armor Class", abbreviation = "AC") = 10;

base resource<dice_roll> hit_points(name = "hp") = null;

calc integer average_hp(name = "Average HP") = hit_points?.average ?? 1;

base string cr(name = "CR") = "cr_0";

base integer xp(name = "Experience") = 0;

calc string cr_xp(name = "CR (XP)") =
  concat(
    [
      enumeratedName(enumerated_type = "monster_cr_types", id = cr),
      " (",
      xp,
      ")",
    ],
  );

base integer initiative(name = "Initiative") = 0;

base integer speed(name = "Speed") = 30;

base integer burrow_speed(name = "Burrow") = 0;

base integer climb_speed(name = "Climb") = 0;

base integer fly_speed(name = "Fly") = 0;

base integer swim_speed(name = "Swim") = 0;

calc string display_speeds(name = "Display speeds") =
  joinToString(
    flatAppend(
      [
        [concat(["Speed ", speed, " ft."])],
        (if burrow_speed > 0 then [concat(["Burrow ", burrow_speed, " ft."])] else []),
        (if climb_speed > 0 then [concat(["Climb ", climb_speed, " ft."])] else []),
        (if fly_speed > 0 then [concat(["Fly ", fly_speed, " ft."])] else []),
        (if swim_speed > 0 then [concat(["Swim ", swim_speed, " ft."])] else []),
      ],
    ),
    separator = "\n",
  );

base integer strength_score(name = "Strength", abbreviation = "STR") = 10;

base integer dexterity_score(name = "Dexterity", abbreviation = "DEX") = 10;

base integer constitution_score(name = "Constitution", abbreviation = "CON") =
  10;

base integer intelligence_score(name = "Intelligence", abbreviation = "INT") =
  10;

base integer wisdom_score(name = "Wisdom", abbreviation = "WIS") = 10;

base integer charisma_score(name = "Charisma", abbreviation = "CHA") = 10;

base integer strength_saving_throw_modifier(name = "Strength saving throw modifier", abbreviation = "STR") =
  0;

base integer dexterity_saving_throw_modifier(name = "Dexterity saving throw modifier", abbreviation = "DEX") =
  0;

base integer constitution_saving_throw_modifier(name = "Constitution saving throw modifier", abbreviation = "CON") =
  0;

base integer intelligence_saving_throw_modifier(name = "Intelligence saving throw modifier", abbreviation = "INT") =
  0;

base integer wisdom_saving_throw_modifier(name = "Wisdom saving throw modifier", abbreviation = "WIS") =
  0;

base integer charisma_saving_throw_modifier(name = "Charisma saving throw modifier", abbreviation = "CHA") =
  0;

base string skills(name = "Skills") = "";

base string gear(name = "Gear") = "";

base string vulnerabilities(name = "Vulnerabilities") = "";

base string immunities(name = "Immunitites") = "";

base string resistances(name = "Resistances") = "";

base string senses(name = "Senses") = "";

base string languages(name = "Languages") = "";

base string size(name = "Size") = "medium";

base string type(name = "Type") = "aberration";

base string alignment(name = "Alignment") = "true_neutral";

base resource<monster_trait>[] traits(name = "Traits") = [];

base resource<monster_action>[] actions(name = "Actions") = [];

base resource<monster_action>[] bonus_actions(name = "Bonus actions") = [];

base resource<monster_action>[] reactions(name = "Reactions") = [];

base resource<monster_action>[] legendary_actions(name = "Legendary actions") =
  [];

base resource<spell>[] spells(name = "Spells") = [];

base string[] habitat(name = "Habitat") = [];

base string[] treasure(name = "Treasure") = [];

calc string formatted_type(name = "Formatted type") =
  enumeratedName(enumerated_type = "monster_types", id = type);

calc string formatted_cr(name = "Formatted cr") =
  enumeratedName(enumerated_type = "monster_cr_types", id = cr);

calc string formatted_xp(name = "Formatted xp") = concat([xp, " XP"]);

calc string type_info(name = "Type info") =
  concat(
    flatAppend(
      [
        [
          enumeratedName(enumerated_type = "monster_sizes", id = size),
          " ",
          enumeratedName(enumerated_type = "monster_types", id = type),
        ],
        (if isEmpty(tag) then [] else [concat([" (", tag, ")"])]),
        [
          ", ",
          enumeratedName(enumerated_type = "monster_alignments", id = alignment),
        ],
      ],
    ),
  );

calc string hit_points_formatted(name = "Formatted hit points") =
  if defined(stat = "$parent.max_hp") && defined(stat = "$parent.hp")
    then concat([$parent.hp, " / ", $parent.max_hp])
    else concat([average_hp, " (", (hit_points?.formula ?? "0"), ")"]);

calc integer strength_modifier(name = "Strength", abbreviation = "STR") =
  divide([(strength_score + -10), 2], rounding_method = "down");

calc integer dexterity_modifier(name = "Dexterity", abbreviation = "DEX") =
  divide([(dexterity_score + -10), 2], rounding_method = "down");

calc integer constitution_modifier(name = "Constitution", abbreviation = "CON") =
  divide([(constitution_score + -10), 2], rounding_method = "down");

calc integer intelligence_modifier(name = "Intelligence", abbreviation = "INT") =
  divide([(intelligence_score + -10), 2], rounding_method = "down");

calc integer wisdom_modifier(name = "Wisdom", abbreviation = "WIS") =
  divide([(wisdom_score + -10), 2], rounding_method = "down");

calc integer charisma_modifier(name = "Charisma", abbreviation = "CHA") =
  divide([(charisma_score + -10), 2], rounding_method = "down");

calc string display_strength_with_mod(name = "Display strength with mod") =
  concat(
    [
      "STR: ",
      strength_score,
      " (",
      toSignedString(strength_modifier),
      ")",
    ],
  );

calc string display_dexterity_with_mod(name = "Display dexterity with mod") =
  concat(
    [
      "DEX: ",
      dexterity_score,
      " (",
      toSignedString(dexterity_modifier),
      ")",
    ],
  );

calc string display_constitution_with_mod(name = "Display constitution with mod") =
  concat(
    [
      "CON: ",
      constitution_score,
      " (",
      toSignedString(constitution_modifier),
      ")",
    ],
  );

calc string display_intelligence_with_mod(name = "Display intelligence with mod") =
  concat(
    [
      "INT: ",
      intelligence_score,
      " (",
      toSignedString(intelligence_modifier),
      ")",
    ],
  );

calc string display_wisdom_with_mod(name = "Display wisdom with mod") =
  concat(
    [
      "WIS: ",
      wisdom_score,
      " (",
      toSignedString(wisdom_modifier),
      ")",
    ],
  );

calc string display_charisma_with_mod(name = "Display charisma with mod") =
  concat(
    [
      "CHA: ",
      charisma_score,
      " (",
      toSignedString(charisma_modifier),
      ")",
    ],
  );

calc string display_strength_save(name = "Display strength save") =
  concat(["STR: ", toSignedString(strength_saving_throw_modifier)]);

calc string display_dexterity_save(name = "Display dexterity save") =
  concat(["DEX: ", toSignedString(dexterity_saving_throw_modifier)]);

calc string display_constitution_save(name = "Display constitution save") =
  concat(
    [
      "CON: ",
      toSignedString(constitution_saving_throw_modifier),
    ],
  );

calc string display_intelligence_save(name = "Display intelligence save") =
  concat(
    [
      "INT: ",
      toSignedString(intelligence_saving_throw_modifier),
    ],
  );

calc string display_wisdom_save(name = "Display wisdom save") =
  concat(["WIS: ", toSignedString(wisdom_saving_throw_modifier)]);

calc string display_charisma_save(name = "Display charisma save") =
  concat(["CHA: ", toSignedString(charisma_saving_throw_modifier)]);

calc string formatted_habitats(name = "Formatted habitats") =
  joinToString(
    map(
      habitat,
      mapper = ($mapValue) => enumeratedName(enumerated_type = "monster_habitats", id = $mapValue),
    ),
    separator = ", ",
  );

calc string formatted_treasure(name = "Formatted treasure") =
  joinToString(
    map(
      treasure,
      mapper = ($mapValue) => enumeratedName(enumerated_type = "monster_treasure_themes", id = $mapValue),
    ),
    separator = ", ",
  );
