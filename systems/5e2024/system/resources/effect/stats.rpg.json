[
  {
    "id": "name",
    "name": "Name",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "description",
    "name": "Description",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_description",
    "default_value": []
  },
  {
    "id": "trigger_type",
    "name": "Trigger type",
    "type": "base",
    "value_type": "string",
    "default_value": "passive"
  },
  {
    "id": "trigger_condition",
    "name": "Trigger condition",
    "type": "base",
    "value_type": "resource",
    "resource_type": "trigger_condition_or",
    "default_value": null
  },
  {
    "id": "has_charges",
    "name": "Has charges",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "charge_type",
    "name": "Charge type",
    "type": "base",
    "value_type": "string",
    "default_value": "constant"
  },
  {
    "id": "recharge_type",
    "name": "Recharge type",
    "type": "base",
    "value_type": "string",
    "default_value": "all"
  },
  {
    "id": "recharge_event",
    "name": "Recharge event",
    "type": "base",
    "value_type": "string",
    "default_value": "long_rest"
  },
  {
    "id": "max_charges_constant",
    "name": "Max charges",
    "type": "base",
    "value_type": "integer",
    "default_value": 0
  },
  {
    "id": "max_charges_levelled_formulas",
    "name": "Max charges levelled formulas",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_value_calculator",
    "default_value": []
  },
  {
    "id": "current_charges",
    "name": "Charges",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "stat",
      "stat": "max_charges_constant"
    }
  },
  {
    "id": "recharges",
    "name": "Max charges",
    "type": "base",
    "value_type": "resource",
    "resource_type": "dice_roll",
    "default_value": null
  },
  {
    "id": "type",
    "name": "Type",
    "type": "base",
    "value_type": "string",
    "default_value": "none"
  },
  {
    "id": "clear_on_remove",
    "name": "Clear on remove",
    "type": "base",
    "value_type": "bool",
    "default_value": true
  },
  {
    "id": "events",
    "name": "Trigger events",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "revert_events",
    "name": "Revert events",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "stat",
    "name": "Stat",
    "type": "base",
    "value_type": "string",
    "default_value": "$character.strength_score"
  },
  {
    "id": "advantage_stat",
    "name": "(dis)advantage stat",
    "type": "base",
    "value_type": "string",
    "default_value": "$character.strength_modifier"
  },
  {
    "id": "aggregation_type",
    "name": "Aggregation type",
    "type": "base",
    "value_type": "string",
    "default_value": "max"
  },
  {
    "id": "dice_roll",
    "name": "Dice",
    "type": "base",
    "value_type": "resource",
    "resource_type": "dice_roll",
    "default_value": null
  },
  {
    "id": "constant",
    "name": "Constant",
    "type": "base",
    "value_type": "integer",
    "default_value": 0
  },
  {
    "id": "spell",
    "name": "Spell",
    "type": "base",
    "value_type": "resource",
    "resource_type": "spell",
    "default_value": null
  },
  {
    "id": "edit_display_name",
    "name": "Edit display name",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "isEmpty",
            "components": {
              "type": "stat",
              "stat": "name"
            }
          },
          "components": {
            "type": "stat",
            "stat": "display_subtitle"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "name"
          }
        }
      ]
    }
  },
  {
    "id": "effect_description",
    "name": "Effect description",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "type"
                },
                {
                  "type": "constant",
                  "value": "none",
                  "value_type": "string"
                }
              ]
            }
          },
          "components": {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "defined",
                  "stat": "$character"
                },
                "components": {
                  "type": "constant",
                  "value": "",
                  "value_type": "string"
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "enumeratedName",
                  "enumerated_type": "effect_types",
                  "id": {
                    "type": "constant",
                    "value": "none",
                    "value_type": "string"
                  }
                }
              }
            ]
          }
        },
        {
          "condition": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "type"
                },
                {
                  "type": "constant",
                  "value": "add_to_stat",
                  "value_type": "string"
                }
              ]
            }
          },
          "components": {
            "type": "concat",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "constant",
                  "value": "Add ",
                  "value_type": "string"
                },
                {
                  "type": "when",
                  "clauses": [
                    {
                      "condition": {
                        "type": "stat",
                        "stat": "is_passive"
                      },
                      "components": {
                        "type": "stat",
                        "stat": "constant"
                      }
                    },
                    {
                      "condition": {
                        "type": "constant",
                        "value": true,
                        "value_type": "bool"
                      },
                      "components": {
                        "type": "stat",
                        "stat": "dice_roll.formula"
                      }
                    }
                  ]
                },
                {
                  "type": "constant",
                  "value": " to ",
                  "value_type": "string"
                },
                {
                  "type": "enumeratedName",
                  "enumerated_type": "effect_character_stats",
                  "id": {
                    "type": "stat",
                    "stat": "stat"
                  }
                }
              ]
            }
          }
        },
        {
          "condition": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "type"
                },
                {
                  "type": "constant",
                  "value": "set_stat",
                  "value_type": "string"
                }
              ]
            }
          },
          "components": {
            "type": "concat",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "constant",
                  "value": "Set ",
                  "value_type": "string"
                },
                {
                  "type": "enumeratedName",
                  "enumerated_type": "effect_character_stats",
                  "id": {
                    "type": "stat",
                    "stat": "stat"
                  }
                },
                {
                  "type": "constant",
                  "value": " to ",
                  "value_type": "string"
                },
                {
                  "type": "when",
                  "clauses": [
                    {
                      "condition": {
                        "type": "stat",
                        "stat": "is_passive"
                      },
                      "components": {
                        "type": "stat",
                        "stat": "constant"
                      }
                    },
                    {
                      "condition": {
                        "type": "constant",
                        "value": true,
                        "value_type": "bool"
                      },
                      "components": {
                        "type": "stat",
                        "stat": "dice_roll.formula"
                      }
                    }
                  ]
                }
              ]
            }
          }
        },
        {
          "condition": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "type"
                },
                {
                  "type": "constant",
                  "value": "disadvantage",
                  "value_type": "string"
                }
              ]
            }
          },
          "components": {
            "type": "concat",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "constant",
                  "value": "Set disadv. on ",
                  "value_type": "string"
                },
                {
                  "type": "enumeratedName",
                  "enumerated_type": "effect_advantage_character_stats",
                  "id": {
                    "type": "stat",
                    "stat": "advantage_stat"
                  }
                }
              ]
            }
          }
        },
        {
          "condition": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "type"
                },
                {
                  "type": "constant",
                  "value": "advantage",
                  "value_type": "string"
                }
              ]
            }
          },
          "components": {
            "type": "concat",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "constant",
                  "value": "Set adv. on ",
                  "value_type": "string"
                },
                {
                  "type": "enumeratedName",
                  "enumerated_type": "effect_advantage_character_stats",
                  "id": {
                    "type": "stat",
                    "stat": "advantage_stat"
                  }
                }
              ]
            }
          }
        },
        {
          "condition": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "type"
                },
                {
                  "type": "constant",
                  "value": "add_spell",
                  "value_type": "string"
                }
              ]
            }
          },
          "components": {
            "type": "concat",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "constant",
                  "value": "Add ",
                  "value_type": "string"
                },
                {
                  "type": "when",
                  "clauses": [
                    {
                      "condition": {
                        "type": "defined",
                        "stat": "spell.name"
                      },
                      "components": {
                        "type": "stat",
                        "stat": "spell.name"
                      }
                    },
                    {
                      "condition": {
                        "type": "constant",
                        "value": true,
                        "value_type": "bool"
                      },
                      "components": {
                        "type": "constant",
                        "value": "no spell",
                        "value_type": "string"
                      }
                    }
                  ]
                },
                {
                  "type": "constant",
                  "value": " to known spells",
                  "value_type": "string"
                }
              ]
            }
          }
        },
        {
          "condition": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "type"
                },
                {
                  "type": "constant",
                  "value": "use_spell",
                  "value_type": "string"
                }
              ]
            }
          },
          "components": {
            "type": "concat",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "constant",
                  "value": "Use ",
                  "value_type": "string"
                },
                {
                  "type": "when",
                  "clauses": [
                    {
                      "condition": {
                        "type": "defined",
                        "stat": "spell.name"
                      },
                      "components": {
                        "type": "stat",
                        "stat": "spell.name"
                      }
                    },
                    {
                      "condition": {
                        "type": "constant",
                        "value": true,
                        "value_type": "bool"
                      },
                      "components": {
                        "type": "constant",
                        "value": "no spell",
                        "value_type": "string"
                      }
                    }
                  ]
                }
              ]
            }
          }
        }
      ]
    }
  },
  {
    "id": "recharges_amount_text",
    "name": "Recharges amount text",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "concat",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "constant",
            "value": "Recharges ",
            "value_type": "string"
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "equals",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "stat",
                        "stat": "recharge_type"
                      },
                      {
                        "type": "constant",
                        "value": "all",
                        "value_type": "string"
                      }
                    ]
                  }
                },
                "components": {
                  "type": "constant",
                  "value": "all",
                  "value_type": "string"
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "defaultIfNull",
                  "components": {
                    "type": "stat",
                    "stat": "recharges?.formula?"
                  },
                  "default_components": {
                    "type": "constant",
                    "value": "0",
                    "value_type": "string"
                  }
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "id": "display_subtitle",
    "name": "Display subtitle",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "joinToString",
      "separator": ", ",
      "components": {
        "type": "flatAppend",
        "components": [
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "isEmpty",
                  "components": {
                    "type": "stat",
                    "stat": "effect_description"
                  }
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "stat",
                      "stat": "effect_description"
                    }
                  ]
                }
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "and",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "equals",
                        "components": {
                          "type": "list",
                          "components": [
                            {
                              "type": "constant",
                              "value": "active",
                              "value_type": "string"
                            },
                            {
                              "type": "stat",
                              "stat": "trigger_type"
                            }
                          ]
                        }
                      },
                      {
                        "type": "or",
                        "components": {
                          "type": "list",
                          "components": [
                            {
                              "type": "notEquals",
                              "components": {
                                "type": "list",
                                "components": [
                                  {
                                    "type": "constant",
                                    "value": "none",
                                    "value_type": "string"
                                  },
                                  {
                                    "type": "stat",
                                    "stat": "type"
                                  }
                                ]
                              }
                            },
                            {
                              "type": "and",
                              "components": {
                                "type": "list",
                                "components": [
                                  {
                                    "type": "stat",
                                    "stat": "has_charges"
                                  },
                                  {
                                    "type": "notEquals",
                                    "components": {
                                      "type": "list",
                                      "components": [
                                        {
                                          "type": "constant",
                                          "value": "active",
                                          "value_type": "string"
                                        },
                                        {
                                          "type": "stat",
                                          "stat": "trigger_type"
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            }
                          ]
                        }
                      }
                    ]
                  }
                },
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "enumeratedName",
                      "enumerated_type": "effect_trigger_types",
                      "id": {
                        "type": "stat",
                        "stat": "trigger_type"
                      }
                    }
                  ]
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "stat",
                  "stat": "has_charges"
                },
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "when",
                      "clauses": [
                        {
                          "condition": {
                            "type": "notEquals",
                            "components": {
                              "type": "list",
                              "components": [
                                {
                                  "type": "stat",
                                  "stat": "recharge_event"
                                },
                                {
                                  "type": "constant",
                                  "value": "manual",
                                  "value_type": "string"
                                }
                              ]
                            }
                          },
                          "components": {
                            "type": "concat",
                            "components": {
                              "type": "list",
                              "components": [
                                {
                                  "type": "stat",
                                  "stat": "recharges_amount_text"
                                },
                                {
                                  "type": "constant",
                                  "value": " at ",
                                  "value_type": "string"
                                },
                                {
                                  "type": "enumeratedName",
                                  "enumerated_type": "lifecycle_events",
                                  "id": {
                                    "type": "stat",
                                    "stat": "recharge_event"
                                  }
                                }
                              ]
                            }
                          }
                        },
                        {
                          "condition": {
                            "type": "constant",
                            "value": true,
                            "value_type": "bool"
                          },
                          "components": {
                            "type": "concat",
                            "components": {
                              "type": "list",
                              "components": [
                                {
                                  "type": "stat",
                                  "stat": "recharges_amount_text"
                                },
                                {
                                  "type": "constant",
                                  "value": " manually",
                                  "value_type": "string"
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  ]
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "id": "is_passive",
    "name": "Is passive trigger_type",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "and",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "trigger_type"
                },
                {
                  "type": "constant",
                  "value_type": "string",
                  "value": "passive"
                }
              ]
            }
          },
          {
            "type": "notEquals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "type"
                },
                {
                  "type": "constant",
                  "value": "use_spell",
                  "value_type": "string"
                }
              ]
            }
          }
        ]
      }
    }
  },
  {
    "id": "is_active",
    "name": "Is active trigger_type",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "equals",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "stat",
            "stat": "trigger_type"
          },
          {
            "type": "constant",
            "value_type": "string",
            "value": "active"
          }
        ]
      }
    }
  },
  {
    "id": "recharge_event_names",
    "name": "Recharge events",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "recharge_event"
                },
                {
                  "type": "constant",
                  "value": "manual",
                  "value_type": "string"
                }
              ]
            }
          },
          "components": {
            "type": "list",
            "components": [
              {
                "type": "eventName",
                "event_name": "recharge"
              }
            ]
          }
        },
        {
          "condition": {
            "type": "constant",
            "value_type": "bool",
            "value": true
          },
          "components": {
            "type": "list",
            "components": [
              {
                "type": "stat",
                "stat": "recharge_event"
              }
            ]
          }
        }
      ]
    }
  },
  {
    "id": "trigger_events",
    "name": "Trigger events",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "is_passive"
                },
                {
                  "type": "notEquals",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "stat",
                        "stat": "type"
                      },
                      {
                        "type": "constant",
                        "value": "none",
                        "value_type": "string"
                      }
                    ]
                  }
                }
              ]
            }
          },
          "components": {
            "type": "list",
            "components": [
              {
                "type": "constant",
                "value_type": "string",
                "value": "rpg_onUpdate"
              }
            ]
          }
        },
        {
          "condition": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "trigger_type"
                },
                {
                  "type": "constant",
                  "value_type": "string",
                  "value": "event"
                }
              ]
            }
          },
          "components": {
            "type": "list",
            "components": [
              {
                "type": "stat",
                "stat": "events"
              }
            ]
          }
        },
        {
          "condition": {
            "type": "constant",
            "value_type": "bool",
            "value": true
          },
          "components": {
            "type": "list",
            "components": [
              {
                "type": "eventName",
                "event_name": "use"
              }
            ]
          }
        }
      ]
    }
  },
  {
    "id": "trigger_revert_events",
    "name": "Revert events",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "stat",
            "stat": "is_passive"
          },
          "components": {
            "type": "constant",
            "value_type": "array",
            "value": []
          }
        },
        {
          "condition": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "trigger_type"
                },
                {
                  "type": "constant",
                  "value_type": "string",
                  "value": "event"
                }
              ]
            }
          },
          "components": {
            "type": "list",
            "components": [
              {
                "type": "stat",
                "stat": "revert_events"
              }
            ]
          }
        },
        {
          "condition": {
            "type": "constant",
            "value_type": "bool",
            "value": true
          },
          "components": {
            "type": "list",
            "components": [
              {
                "type": "eventName",
                "event_name": "revert"
              }
            ]
          }
        }
      ]
    }
  },
  {
    "id": "can_execute",
    "name": "Trigger condition allows execution",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "and",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "$parent?.should_load_effects?"
            },
            "default_components": {
              "type": "constant",
              "value": true,
              "value_type": "bool"
            }
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "defined",
                  "stat": "$parent.is_attuned"
                },
                "components": {
                  "type": "or",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "stat",
                        "stat": "$parent.is_attuned"
                      },
                      {
                        "type": "not",
                        "components": {
                          "type": "stat",
                          "stat": "$parent.requires_attunement"
                        }
                      }
                    ]
                  }
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                }
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "defined",
                  "stat": "$parent.is_equipped"
                },
                "components": {
                  "type": "or",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "stat",
                        "stat": "$parent.is_equipped"
                      },
                      {
                        "type": "not",
                        "components": {
                          "type": "stat",
                          "stat": "$parent.requires_equipping"
                        }
                      }
                    ]
                  }
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                }
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "defined",
                  "stat": "$parent.is_levelled"
                },
                "components": {
                  "type": "when",
                  "clauses": [
                    {
                      "condition": {
                        "type": "stat",
                        "stat": "$parent.is_levelled"
                      },
                      "components": {
                        "type": "stat",
                        "stat": "$parent.can_execute"
                      }
                    },
                    {
                      "condition": {
                        "type": "constant",
                        "value": true,
                        "value_type": "bool"
                      },
                      "components": {
                        "type": "constant",
                        "value": true,
                        "value_type": "bool"
                      }
                    }
                  ]
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                }
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "equals",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "stat",
                        "stat": "trigger_condition"
                      },
                      {
                        "type": "constant",
                        "value": null,
                        "value_type": "string"
                      }
                    ]
                  }
                },
                "components": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "stat",
                  "stat": "trigger_condition.evaluated_value"
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "id": "is_add_to_stat",
    "name": "Is add to stat",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "equals",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "constant",
            "value": "add_to_stat",
            "value_type": "string"
          },
          {
            "type": "stat",
            "stat": "$view?.edit_effect_type_select?"
          }
        ]
      }
    }
  },
  {
    "id": "is_set_stat",
    "name": "Is set stat",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "equals",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "constant",
            "value": "set_stat",
            "value_type": "string"
          },
          {
            "type": "stat",
            "stat": "$view?.edit_effect_type_select?"
          }
        ]
      }
    }
  },
  {
    "id": "is_set_or_add_to_stat",
    "name": "Is setStat or addToStat type",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "stat",
            "stat": "is_add_to_stat"
          },
          {
            "type": "stat",
            "stat": "is_set_stat"
          }
        ]
      }
    }
  },
  {
    "id": "is_advantage",
    "name": "Is advantage",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "equals",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "constant",
            "value": "advantage",
            "value_type": "string"
          },
          {
            "type": "stat",
            "stat": "$view?.edit_effect_type_select?"
          }
        ]
      }
    }
  },
  {
    "id": "is_disadvantage",
    "name": "Is disadvantage",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "equals",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "constant",
            "value": "disadvantage",
            "value_type": "string"
          },
          {
            "type": "stat",
            "stat": "$view?.edit_effect_type_select?"
          }
        ]
      }
    }
  },
  {
    "id": "is_advantage_or_disadvantage_type",
    "name": "Is setStat or addToStat type",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "stat",
            "stat": "is_advantage"
          },
          {
            "type": "stat",
            "stat": "is_disadvantage"
          }
        ]
      }
    }
  },
  {
    "id": "is_spell_type",
    "name": "Is addSpell or useSpell type",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "constant",
                  "value": "add_spell",
                  "value_type": "string"
                },
                {
                  "type": "stat",
                  "stat": "$view?.edit_effect_type_select?"
                }
              ]
            }
          },
          {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "constant",
                  "value": "use_spell",
                  "value_type": "string"
                },
                {
                  "type": "stat",
                  "stat": "$view?.edit_effect_type_select?"
                }
              ]
            }
          }
        ]
      }
    }
  },
  {
    "id": "max_charges_display_text",
    "name": "Max charges display text",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "charge_type"
                },
                {
                  "type": "constant",
                  "value": "constant",
                  "value_type": "string"
                }
              ]
            }
          },
          "components": {
            "type": "concat",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "max_charges_constant"
                },
                {
                  "type": "constant",
                  "value": " charges",
                  "value_type": "string"
                }
              ]
            }
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "constant",
            "value": "Special amnt of charges",
            "value_type": "string"
          }
        }
      ]
    }
  },
  {
    "id": "max_charges",
    "name": "Max charges",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "charge_type"
                },
                {
                  "type": "constant",
                  "value": "constant",
                  "value_type": "string"
                }
              ]
            }
          },
          "components": {
            "type": "stat",
            "stat": "max_charges_constant"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "current_level_max_charges_formula?.calculated_value"
            },
            "default_components": {
              "type": "constant",
              "value": 0,
              "value_type": "integer"
            }
          }
        }
      ]
    }
  },
  {
    "id": "current_level_max_charges_formula",
    "name": "Max charges formula for the current level",
    "type": "calculated",
    "value_type": "resource",
    "components": {
      "type": "findFirst",
      "components": {
        "type": "sortBy",
        "order": "desc",
        "components": {
          "type": "stat",
          "stat": "max_charges_levelled_formulas"
        },
        "sort_by_selector": {
          "type": "stat",
          "stat": "$sortByValue.level"
        }
      },
      "filter": {
        "type": "lessThanEquals",
        "components": {
          "type": "list",
          "components": [
            {
              "type": "stat",
              "stat": "$findFirstValue.level"
            },
            {
              "type": "stat",
              "stat": "current_level"
            }
          ]
        }
      }
    }
  },
  {
    "id": "current_level",
    "name": "Current level",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "defined",
            "stat": "$parent.current_level"
          },
          "components": {
            "type": "stat",
            "stat": "$parent.current_level"
          }
        },
        {
          "condition": {
            "type": "defined",
            "stat": "$character.level"
          },
          "components": {
            "type": "stat",
            "stat": "$character.level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "constant",
            "value": 1,
            "value_type": "integer"
          }
        }
      ]
    }
  },
  {
    "id": "current_level_levelled_description",
    "name": "Current level levelled_description",
    "type": "calculated",
    "value_type": "resource",
    "components": {
      "type": "findFirst",
      "components": {
        "type": "sortBy",
        "order": "desc",
        "components": {
          "type": "stat",
          "stat": "description"
        },
        "sort_by_selector": {
          "type": "stat",
          "stat": "$sortByValue.level"
        }
      },
      "filter": {
        "type": "lessThanEquals",
        "components": {
          "type": "list",
          "components": [
            {
              "type": "stat",
              "stat": "$findFirstValue.level"
            },
            {
              "type": "stat",
              "stat": "current_level"
            }
          ]
        }
      }
    }
  },
  {
    "id": "current_level_description",
    "name": "Current level description",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "defaultIfNull",
      "components": {
        "type": "stat",
        "stat": "current_level_levelled_description?.description"
      },
      "default_components": {
        "type": "constant",
        "value": "",
        "value_type": "string"
      }
    }
  }
]