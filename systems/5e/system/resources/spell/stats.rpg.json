[
  {
    "id": "name",
    "name": "Name",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "source",
    "name": "Source",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "level",
    "name": "Level",
    "type": "base",
    "value_type": "string",
    "default_value": "spell_level_0"
  },
  {
    "id": "school",
    "name": "School",
    "type": "base",
    "value_type": "string",
    "default_value": "spell_school_abjuration"
  },
  {
    "id": "ritual",
    "name": "Ritual",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "casting_time",
    "name": "Casting time",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "display_casting_time",
    "name": "Display casting time",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "stat",
            "stat": "ritual"
          },
          "components": {
            "type": "concat",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "casting_time"
                },
                {
                  "type": "constant",
                  "value": " or ritual",
                  "value_type": "string"
                }
              ]
            }
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "casting_time"
          }
        }
      ]
    }
  },
  {
    "id": "range",
    "name": "Range",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "duration",
    "name": "Duration",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "verbal",
    "name": "Verbal",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "somatic",
    "name": "Somatic",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "material",
    "name": "Material",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "components",
    "name": "Components",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "description",
    "name": "Description",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "higher_level_description",
    "name": "Higher level description",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "classes",
    "name": "Classes",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "string",
    "default_value": []
  },
  {
    "id": "dice",
    "name": "Dice",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_damage_dice",
    "default_value": []
  },
  {
    "id": "effects",
    "name": "Effects",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "effect",
    "default_value": []
  },
  {
    "id": "prepared",
    "name": "Prepared",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "cast_level",
    "name": "Cast level",
    "type": "base",
    "value_type": "integer",
    "default_value": 1
  },
  {
    "id": "is_cantrip",
    "name": "Is cantrip",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "equals",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "stat",
            "stat": "level"
          },
          {
            "type": "constant",
            "value": "spell_level_0",
            "value_type": "string"
          }
        ]
      }
    }
  },
  {
    "id": "num_level",
    "name": "Numerical level",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "toNum",
      "components": {
        "type": "replace",
        "string": {
          "type": "stat",
          "stat": "level"
        },
        "occurrence": {
          "type": "constant",
          "value": "spell_level_",
          "value_type": "string"
        },
        "replace": {
          "type": "constant",
          "value": "",
          "value_type": "string"
        }
      }
    }
  },
  {
    "id": "has_higher_level_description",
    "name": "Has higher level description",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "greaterThan",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "length",
            "components": {
              "type": "stat",
              "stat": "higher_level_description"
            }
          },
          {
            "type": "constant",
            "value": 0,
            "value_type": "integer"
          }
        ]
      }
    }
  },
  {
    "id": "display_type",
    "name": "Type",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "concat",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "enumeratedName",
            "enumerated_type": "spell_level",
            "id": {
              "type": "stat",
              "stat": "level"
            }
          },
          {
            "type": "constant",
            "value": " ",
            "value_type": "string"
          },
          {
            "type": "enumeratedName",
            "enumerated_type": "spell_school",
            "id": {
              "type": "stat",
              "stat": "school"
            }
          }
        ]
      }
    }
  },
  {
    "id": "string_components",
    "name": "Stringified components VSM",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "joinToString",
      "separator": ", ",
      "components": {
        "type": "flatAppend",
        "components": [
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "equals",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "constant",
                        "value": true,
                        "value_type": "bool"
                      },
                      {
                        "type": "stat",
                        "stat": "verbal"
                      }
                    ]
                  }
                },
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "constant",
                      "value": "V",
                      "value_type": "string"
                    }
                  ]
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "equals",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "constant",
                        "value": true,
                        "value_type": "bool"
                      },
                      {
                        "type": "stat",
                        "stat": "somatic"
                      }
                    ]
                  }
                },
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "constant",
                      "value": "S",
                      "value_type": "string"
                    }
                  ]
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "equals",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "constant",
                        "value": true,
                        "value_type": "bool"
                      },
                      {
                        "type": "stat",
                        "stat": "material"
                      }
                    ]
                  }
                },
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "constant",
                      "value": "M",
                      "value_type": "string"
                    }
                  ]
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "id": "has_components",
    "name": "Has components VSM",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "stat",
            "stat": "verbal"
          },
          {
            "type": "stat",
            "stat": "somatic"
          },
          {
            "type": "stat",
            "stat": "material"
          }
        ]
      }
    }
  },
  {
    "id": "display_requirements",
    "name": "Requirements",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "concat",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "stat",
            "stat": "casting_time"
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "stat",
                  "stat": "has_components"
                },
                "components": {
                  "type": "concat",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "constant",
                        "value": " (",
                        "value_type": "string"
                      },
                      {
                        "type": "stat",
                        "stat": "string_components"
                      },
                      {
                        "type": "constant",
                        "value": ")",
                        "value_type": "string"
                      }
                    ]
                  }
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "constant",
                  "value": "",
                  "value_type": "string"
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "id": "full_components",
    "name": "Full components",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "stat",
            "stat": "material"
          },
          "components": {
            "type": "concat",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "string_components"
                },
                {
                  "type": "constant",
                  "value": " (",
                  "value_type": "string"
                },
                {
                  "type": "stat",
                  "stat": "components"
                },
                {
                  "type": "constant",
                  "value": ")",
                  "value_type": "string"
                }
              ]
            }
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "string_components"
          }
        }
      ]
    }
  },
  {
    "id": "character_spell_slots_defined",
    "name": "Character and spell slots defined",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "and",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "defined",
            "stat": "$character"
          },
          {
            "type": "defined",
            "stat": "$character.spell_slots_1"
          },
          {
            "type": "defined",
            "stat": "$character.spell_slots_2"
          },
          {
            "type": "defined",
            "stat": "$character.spell_slots_3"
          },
          {
            "type": "defined",
            "stat": "$character.spell_slots_4"
          },
          {
            "type": "defined",
            "stat": "$character.spell_slots_5"
          },
          {
            "type": "defined",
            "stat": "$character.spell_slots_6"
          },
          {
            "type": "defined",
            "stat": "$character.spell_slots_7"
          },
          {
            "type": "defined",
            "stat": "$character.spell_slots_8"
          },
          {
            "type": "defined",
            "stat": "$character.spell_slots_9"
          }
        ]
      }
    }
  },
  {
    "id": "prepare_button_text",
    "name": "Prepare button text",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "stat",
            "stat": "prepared"
          },
          "components": {
            "type": "constant",
            "value": "UNPREPARE",
            "value_type": "string"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "constant",
            "value": "PREPARE",
            "value_type": "string"
          }
        }
      ]
    }
  },
  {
    "id": "available_slots_for_use",
    "name": "Available slots for use",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "integer",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "stat",
            "stat": "character_spell_slots_defined"
          },
          "components": {
            "type": "filter",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "constant",
                  "value": 1,
                  "value_type": "integer"
                },
                {
                  "type": "constant",
                  "value": 2,
                  "value_type": "integer"
                },
                {
                  "type": "constant",
                  "value": 3,
                  "value_type": "integer"
                },
                {
                  "type": "constant",
                  "value": 4,
                  "value_type": "integer"
                },
                {
                  "type": "constant",
                  "value": 5,
                  "value_type": "integer"
                },
                {
                  "type": "constant",
                  "value": 6,
                  "value_type": "integer"
                },
                {
                  "type": "constant",
                  "value": 7,
                  "value_type": "integer"
                },
                {
                  "type": "constant",
                  "value": 8,
                  "value_type": "integer"
                },
                {
                  "type": "constant",
                  "value": 9,
                  "value_type": "integer"
                }
              ]
            },
            "filter": {
              "type": "and",
              "components": {
                "type": "list",
                "components": [
                  {
                    "type": "greaterThanEquals",
                    "components": {
                      "type": "list",
                      "components": [
                        {
                          "type": "stat",
                          "stat": "$filterValue"
                        },
                        {
                          "type": "stat",
                          "stat": "num_level"
                        }
                      ]
                    }
                  },
                  {
                    "type": "greaterThan",
                    "components": {
                      "type": "list",
                      "components": [
                        {
                          "type": "metaStat",
                          "meta_stat": {
                            "type": "concat",
                            "components": {
                              "type": "list",
                              "components": [
                                {
                                  "type": "constant",
                                  "value": "$character.spell_slots_",
                                  "value_type": "string"
                                },
                                {
                                  "type": "stat",
                                  "stat": "$filterValue"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "type": "constant",
                          "value": 0,
                          "value_type": "integer"
                        }
                      ]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "list",
            "components": [
              {
                "type": "constant",
                "value": 1,
                "value_type": "integer"
              }
            ]
          }
        }
      ]
    }
  },
  {
    "id": "selected_spell_slots_stat_name",
    "name": "Selected spell slots stat name",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "concat",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "constant",
            "value": "$character.spell_slots_",
            "value_type": "string"
          },
          {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "$view?.spell_display_cast_composite_ticker?"
            },
            "default_components": {
              "type": "constant",
              "value": "0",
              "value_type": "string"
            }
          }
        ]
      }
    }
  },
  {
    "id": "available_selected_slots",
    "name": "Available selected spell slots",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "character_spell_slots_defined"
                },
                {
                  "type": "notEquals",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "stat",
                        "stat": "selected_spell_slots_stat_name"
                      },
                      {
                        "type": "constant",
                        "value": "$character.spell_slots_0",
                        "value_type": "string"
                      }
                    ]
                  }
                }
              ]
            }
          },
          "components": {
            "type": "metaStat",
            "meta_stat": {
              "type": "stat",
              "ignore_cache": true,
              "stat": "selected_spell_slots_stat_name"
            }
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "constant",
            "value": 0,
            "value_type": "integer"
          }
        }
      ]
    }
  },
  {
    "id": "should_select_spell_slot_to_cast",
    "name": "Should select a spell slot to cast",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "and",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "defined",
            "stat": "$character"
          },
          {
            "type": "not",
            "components": {
              "type": "stat",
              "stat": "is_cantrip"
            }
          },
          {
            "type": "not",
            "components": {
              "type": "isEmpty",
              "components": {
                "type": "stat",
                "stat": "available_slots_for_use"
              }
            }
          }
        ]
      }
    }
  },
  {
    "id": "character_is_not_wearing_inproficient_armor",
    "name": "Character is not currently wear a piece of armor its not proficient with",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "defaultIfNull",
      "components": {
        "type": "stat",
        "stat": "$character?.is_not_wearing_inproficient_armor"
      },
      "default_components": {
        "type": "constant",
        "value": true,
        "value_type": "bool"
      }
    }
  },
  {
    "id": "has_required_spell_slots_to_cast",
    "name": "Has required spell slots to cast",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "stat",
            "stat": "is_cantrip"
          },
          {
            "type": "not",
            "components": {
              "type": "isEmpty",
              "components": {
                "type": "stat",
                "stat": "available_slots_for_use"
              }
            }
          }
        ]
      }
    }
  },
  {
    "id": "can_cast",
    "name": "Can cast spell",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "and",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "stat",
            "stat": "character_is_not_wearing_inproficient_armor"
          },
          {
            "type": "stat",
            "stat": "has_required_spell_slots_to_cast"
          }
        ]
      }
    }
  }
]