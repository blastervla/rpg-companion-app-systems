{
  "id": "feat_display",
  "type": "list",
  "padding": 16,
  "alignment": "start",
  "subviews": [
    {
      "id": "feat_display_non_level_up",
      "type": "list",
      "is_visible": {
        "type": "not",
        "components": {
          "type": "defaultIfNull",
          "components": {
            "type": "stat",
            "stat": "$character?.currently_levelling_up"
          },
          "default_components": {
            "type": "constant",
            "value": false,
            "value_type": "bool"
          }
        }
      },
      "subviews": [
        {
          "id": "feat_display_info",
          "type": "composite",
          "margin_left": 16,
          "subviews": [
            {
              "id": "feat_display_source",
              "type": "text",
              "style": "caption",
              "resource_id": "source",
              "resource_instance_ids_stat": "source",
              "resource_display_stat": "abbreviation",
              "is_visible": {
                "type": "not",
                "components": {
                  "type": "isEmpty",
                  "components": {
                    "type": "stat",
                    "stat": "source"
                  }
                }
              }
            },
            {
              "id": "feat_display_source_separator",
              "type": "text",
              "text": {
                "type": "constant",
                "value": ", ",
                "value_type": "string"
              },
              "style": "caption",
              "is_visible": {
                "type": "not",
                "components": {
                  "type": "isEmpty",
                  "components": {
                    "type": "stat",
                    "stat": "source"
                  }
                }
              }
            },
            {
              "id": "feat_display_prerequisites",
              "type": "text",
              "text": {
                "type": "concat",
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "constant",
                      "value": "Prerequisites: ",
                      "value_type": "string"
                    },
                    {
                      "type": "stat",
                      "stat": "prerequisites"
                    }
                  ]
                }
              },
              "style": "caption",
              "is_visible": {
                "type": "not",
                "components": {
                  "type": "isEmpty",
                  "components": {
                    "type": "stat",
                    "stat": "prerequisites"
                  }
                }
              }
            }
          ]
        },
        {
          "id": "feat_display_current_level_description",
          "type": "text",
          "text": {
            "type": "stat",
            "stat": "current_level_description"
          },
          "style": "text"
        },
        {
          "id": "feat_display_all_descriptions_collapsible",
          "type": "collapsible",
          "margin_top": 8,
          "title": {
            "type": "constant",
            "value": "All descriptions (by level)",
            "value_type": "string"
          },
          "is_visible": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "or",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "not",
                        "components": {
                          "type": "defined",
                          "stat": "$character"
                        }
                      },
                      {
                        "type": "defined",
                        "stat": "$character.$is_new"
                      }
                    ]
                  }
                },
                {
                  "type": "greaterThan",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "length",
                        "components": {
                          "type": "stat",
                          "stat": "sorted_descriptions"
                        }
                      },
                      {
                        "type": "constant",
                        "value": 1,
                        "value_type": "integer"
                      }
                    ]
                  }
                }
              ]
            }
          },
          "subviews": [
            {
              "id": "feat_display_descriptions",
              "type": "resourceArray",
              "resource_id": "levelled_description",
              "stat": "sorted_descriptions",
              "view_type": "display"
            }
          ]
        },
        {
          "id": "feat_display_available_effects_collapsible",
          "type": "collapsible",
          "margin_top": 8,
          "title": {
            "type": "constant",
            "value": "Magic effects",
            "value_type": "string"
          },
          "is_visible": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "not",
                  "components": {
                    "type": "isEmpty",
                    "components": {
                      "type": "stat",
                      "stat": "available_effects_for_current_level"
                    }
                  }
                },
                {
                  "type": "defined",
                  "stat": "$character"
                },
                {
                  "type": "not",
                  "components": {
                    "type": "defined",
                    "stat": "$character.$is_new"
                  }
                }
              ]
            }
          },
          "subviews": [
            {
              "id": "feat_display_effects",
              "type": "resourceArray",
              "resource_id": "effect",
              "stat": "available_effects_for_current_level",
              "view_type": "display"
            }
          ]
        },
        {
          "id": "feat_display_effects_collapsible",
          "type": "collapsible",
          "margin_top": 8,
          "title": {
            "type": "constant",
            "value": "Magic effects",
            "value_type": "string"
          },
          "is_visible": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "not",
                  "components": {
                    "type": "isEmpty",
                    "components": {
                      "type": "stat",
                      "stat": "sorted_effects"
                    }
                  }
                },
                {
                  "type": "or",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "not",
                        "components": {
                          "type": "defined",
                          "stat": "$character"
                        }
                      },
                      {
                        "type": "defined",
                        "stat": "$character.$is_new"
                      }
                    ]
                  }
                }
              ]
            }
          },
          "subviews": [
            {
              "id": "feat_display_effects",
              "type": "resourceArray",
              "resource_id": "effect",
              "stat": "sorted_effects",
              "view_type": "display"
            }
          ]
        },
        {
          "id": "feat_display_selectable_features_collapsible",
          "type": "collapsible",
          "margin_top": 8,
          "title": {
            "type": "constant",
            "value": "All selectable features (by level)",
            "value_type": "string"
          },
          "is_visible": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "has_selectable_features"
                },
                {
                  "type": "not",
                  "components": {
                    "type": "isEmpty",
                    "components": {
                      "type": "stat",
                      "stat": "sorted_selectable_features"
                    }
                  }
                },
                {
                  "type": "or",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "not",
                        "components": {
                          "type": "defined",
                          "stat": "$character"
                        }
                      },
                      {
                        "type": "defined",
                        "stat": "$character.$is_new"
                      }
                    ]
                  }
                }
              ]
            }
          },
          "subviews": [
            {
              "id": "feat_display_selectable_feature_amount_per_level",
              "type": "resourceArray",
              "resource_id": "levelled_amount",
              "stat": "sorted_selectable_feature_amount_per_level",
              "view_type": "display"
            },
            {
              "id": "feat_display_selectable_features",
              "type": "resourceArray",
              "resource_id": "feat",
              "stat": "sorted_selectable_features",
              "view_type": "list"
            }
          ]
        }
      ]
    },
    {
      "id": "feat_display_level_up_selectable_feature",
      "type": "text",
      "text": {
        "type": "constant",
        "value": "Your level up allowed you to select some additional features:",
        "value_type": "string"
      },
      "style": "text",
      "is_visible": {
        "type": "defaultIfNull",
        "components": {
          "type": "stat",
          "stat": "$character?.currently_levelling_up"
        },
        "default_components": {
          "type": "constant",
          "value": false,
          "value_type": "bool"
        }
      }
    },
    {
      "id": "feat_display_selectable_features_select_collapsible",
      "type": "collapsible",
      "margin_top": 8,
      "title": {
        "type": "constant",
        "value": "Chosen selectable features",
        "value_type": "string"
      },
      "is_visible": {
        "type": "and",
        "components": {
          "type": "list",
          "components": [
            {
              "type": "stat",
              "stat": "has_selectable_features"
            },
            {
              "type": "greaterThan",
              "components": {
                "type": "list",
                "components": [
                  {
                    "type": "stat",
                    "stat": "current_allowed_amount_of_selectable_features"
                  },
                  {
                    "type": "constant",
                    "value": 0,
                    "value_type": "integer"
                  }
                ]
              }
            },
            {
              "type": "not",
              "components": {
                "type": "isEmpty",
                "components": {
                  "type": "stat",
                  "stat": "available_selectable_features_for_current_level"
                }
              }
            },
            {
              "type": "defined",
              "stat": "$character"
            },
            {
              "type": "not",
              "components": {
                "type": "defined",
                "stat": "$character.$is_new"
              }
            }
          ]
        }
      },
      "subviews": [
        {
          "id": "feat_display_allowed_amount_of_selectable_features",
          "type": "text",
          "text": {
            "type": "stat",
            "stat": "current_allowed_amount_of_selectable_features_label_text"
          },
          "style": "text"
        },
        {
          "id": "feat_display_selectable_features_select",
          "type": "select",
          "stat": "chosen_selectable_features",
          "resource_options": {
            "type": "stat",
            "stat": "available_selectable_features_for_current_level"
          },
          "max_selection_amount": {
            "type": "stat",
            "stat": "current_allowed_amount_of_selectable_features"
          },
          "options_display_stat": "name",
          "multi_select": true,
          "style": "list"
        },
        {
          "id": "feat_display_selectable_features_save_button",
          "type": "button",
          "text": {
            "type": "constant",
            "value": "SAVE",
            "value_type": "string"
          },
          "event": {
            "name": "saveSelectableFeaturesChoice",
            "payload": {}
          }
        }
      ]
    }
  ]
}