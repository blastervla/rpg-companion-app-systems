{
  "id": "weapon_roll_attack",
  "event_names": "attack",
  "effects": {
    "type": "sequence",
    "effects": [
      {
        "type": "when",
        "clauses": [
          {
            "condition": {
              "type": "stat",
              "stat": "has_ammunition"
            },
            "effect": {
              "type": "fireEvent",
              "event": {
                "name": "shoot_ammo"
              }
            }
          }
        ]
      },
      {
        "type": "roll",
        "rolls": {
          "type": "list",
          "components": [
            {
              "type": "rollable",
              "formulas": {
                "type": "list",
                "components": [
                  {
                    "type": "concat",
                    "components": {
                      "type": "list",
                      "components": [
                        {
                          "type": "when",
                          "clauses": [
                            {
                              "condition": {
                                "type": "equals",
                                "components": {
                                  "type": "list",
                                  "components": [
                                    {
                                      "type": "stat",
                                      "stat": "$view.weapon_display_advantage_disadvantage_select"
                                    },
                                    {
                                      "type": "constant",
                                      "value": "disadvantage",
                                      "value_type": "string"
                                    }
                                  ]
                                }
                              },
                              "components": {
                                "type": "constant",
                                "value": "min(2d20) + ",
                                "value_type": "string"
                              }
                            },
                            {
                              "condition": {
                                "type": "equals",
                                "components": {
                                  "type": "list",
                                  "components": [
                                    {
                                      "type": "stat",
                                      "stat": "$view.weapon_display_advantage_disadvantage_select"
                                    },
                                    {
                                      "type": "constant",
                                      "value": "advantage",
                                      "value_type": "string"
                                    }
                                  ]
                                }
                              },
                              "components": {
                                "type": "constant",
                                "value": "max(2d20) + ",
                                "value_type": "string"
                              }
                            },
                            {
                              "condition": {
                                "type": "constant",
                                "value": true,
                                "value_type": "bool"
                              },
                              "components": {
                                "type": "constant",
                                "value": "1d20 + ",
                                "value_type": "string"
                              }
                            }
                          ]
                        },
                        {
                          "type": "stat",
                          "stat": "attack_bonus"
                        }
                      ]
                    }
                  }
                ]
              },
              "text": {
                "type": "constant",
                "value": "to hit",
                "value_type": "string"
              }
            }
          ]
        }
      },
      {
        "type": "delayed",
        "millis": 500,
        "effect": {
          "type": "dismissResource"
        }
      }
    ]
  }
}