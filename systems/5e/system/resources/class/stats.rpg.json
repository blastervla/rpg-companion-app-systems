[
  {
    "id": "name",
    "name": "Name",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "source",
    "name": "Source",
    "type": "base",
    "value_type": "string",
    "default_value": ""
  },
  {
    "id": "hit_die",
    "name": "Hit die",
    "type": "base",
    "value_type": "string",
    "default_value": "d8"
  },
  {
    "id": "hp_modifiers",
    "name": "HP Modifiers",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "string",
    "default_value": [
      "constitution"
    ]
  },
  {
    "id": "actual_hit_die",
    "name": "Actual hit die",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "notNull",
                  "components": {
                    "type": "stat",
                    "stat": "selected_archetype"
                  }
                },
                {
                  "type": "not",
                  "components": {
                    "type": "defaultIfNull",
                    "components": {
                      "type": "stat",
                      "stat": "selected_archetype?.same_hp_as_parent"
                    },
                    "default_components": {
                      "type": "constant",
                      "value": true,
                      "value_type": "bool"
                    }
                  }
                }
              ]
            }
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.hit_die"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "hit_die"
          }
        }
      ]
    }
  },
  {
    "id": "actual_hp_modifiers",
    "name": "Actual HP modifiers",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "notNull",
                  "components": {
                    "type": "stat",
                    "stat": "selected_archetype"
                  }
                },
                {
                  "type": "not",
                  "components": {
                    "type": "defaultIfNull",
                    "components": {
                      "type": "stat",
                      "stat": "selected_archetype?.same_hp_as_parent"
                    },
                    "default_components": {
                      "type": "constant",
                      "value": true,
                      "value_type": "bool"
                    }
                  }
                }
              ]
            }
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.hp_modifiers"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "hp_modifiers"
          }
        }
      ]
    }
  },
  {
    "id": "same_hp_as_parent",
    "name": "Same HP as parent",
    "type": "base",
    "value_type": "bool",
    "default_value": true
  },
  {
    "id": "base_ac",
    "name": "Base AC",
    "type": "base",
    "value_type": "integer",
    "default_value": 10
  },
  {
    "id": "ac_modifiers",
    "name": "AC Modifiers",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "string",
    "default_value": [
      "dexterity"
    ]
  },
  {
    "id": "actual_base_ac",
    "name": "Actual base AC",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "notNull",
                  "components": {
                    "type": "stat",
                    "stat": "selected_archetype"
                  }
                },
                {
                  "type": "not",
                  "components": {
                    "type": "defaultIfNull",
                    "components": {
                      "type": "stat",
                      "stat": "selected_archetype?.same_ac_as_parent"
                    },
                    "default_components": {
                      "type": "constant",
                      "value": true,
                      "value_type": "bool"
                    }
                  }
                }
              ]
            }
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.base_ac"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "base_ac"
          }
        }
      ]
    }
  },
  {
    "id": "actual_ac_modifiers",
    "name": "Actual AC modifiers",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "notNull",
                  "components": {
                    "type": "stat",
                    "stat": "selected_archetype"
                  }
                },
                {
                  "type": "not",
                  "components": {
                    "type": "defaultIfNull",
                    "components": {
                      "type": "stat",
                      "stat": "selected_archetype?.same_ac_as_parent"
                    },
                    "default_components": {
                      "type": "constant",
                      "value": true,
                      "value_type": "bool"
                    }
                  }
                }
              ]
            }
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.ac_modifiers"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "ac_modifiers"
          }
        }
      ]
    }
  },
  {
    "id": "same_ac_as_parent",
    "name": "Same AC as parent",
    "type": "base",
    "value_type": "bool",
    "default_value": true
  },
  {
    "id": "strength_saving_throw_proficiency",
    "name": "Strength saving throw proficiency",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "dexterity_saving_throw_proficiency",
    "name": "Dexterity saving throw proficiency",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "constitution_saving_throw_proficiency",
    "name": "Constitution saving throw proficiency",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "intelligence_saving_throw_proficiency",
    "name": "Intelligence saving throw proficiency",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "wisdom_saving_throw_proficiency",
    "name": "Wisdom saving throw proficiency",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "charisma_saving_throw_proficiency",
    "name": "Charisma saving throw proficiency",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "features",
    "name": "Features",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "feat",
    "default_value": []
  },
  {
    "id": "same_spellcasting_ability_as_parent",
    "name": "Same spellcasting ability as parent",
    "type": "base",
    "value_type": "bool",
    "default_value": true
  },
  {
    "id": "spellcasting_ability",
    "name": "Spellcasting ability",
    "type": "base",
    "value_type": "string",
    "default_value": "intelligence"
  },
  {
    "id": "actual_spellcasting_ability",
    "name": "Actual spellcasting ability",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "notNull",
                  "components": {
                    "type": "stat",
                    "stat": "selected_archetype"
                  }
                },
                {
                  "type": "not",
                  "components": {
                    "type": "defaultIfNull",
                    "components": {
                      "type": "stat",
                      "stat": "selected_archetype?.same_spellcasting_ability_as_parent"
                    },
                    "default_components": {
                      "type": "constant",
                      "value": true,
                      "value_type": "bool"
                    }
                  }
                }
              ]
            }
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.spellcasting_ability"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "spellcasting_ability"
          }
        }
      ]
    }
  },
  {
    "id": "same_effective_caster_level_as_parent",
    "name": "Same effective caster level as parent",
    "type": "base",
    "value_type": "bool",
    "default_value": true
  },
  {
    "id": "effective_caster_level",
    "name": "Effective caster level",
    "type": "base",
    "value_type": "string",
    "default_value": "zero"
  },
  {
    "id": "actual_effective_caster_level",
    "name": "Actual effective caster level",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "notNull",
                  "components": {
                    "type": "stat",
                    "stat": "selected_archetype"
                  }
                },
                {
                  "type": "not",
                  "components": {
                    "type": "defaultIfNull",
                    "components": {
                      "type": "stat",
                      "stat": "selected_archetype?.same_effective_caster_level_as_parent"
                    },
                    "default_components": {
                      "type": "constant",
                      "value": true,
                      "value_type": "bool"
                    }
                  }
                }
              ]
            }
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.effective_caster_level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "effective_caster_level"
          }
        }
      ]
    }
  },
  {
    "id": "spells",
    "name": "Spells",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "spell",
    "default_value": []
  },
  {
    "id": "recharge_slots_on_short_rest",
    "name": "Recharge slots on short rest",
    "type": "base",
    "value_type": "bool",
    "default_value": false
  },
  {
    "id": "spell_slots_level_1_per_level",
    "name": "Spell slots level 1 (per level)",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "default_value": []
  },
  {
    "id": "spell_slots_level_2_per_level",
    "name": "Spell slots level 2 (per level)",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "default_value": []
  },
  {
    "id": "spell_slots_level_3_per_level",
    "name": "Spell slots level 3 (per level)",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "default_value": []
  },
  {
    "id": "spell_slots_level_4_per_level",
    "name": "Spell slots level 4 (per level)",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "default_value": []
  },
  {
    "id": "spell_slots_level_5_per_level",
    "name": "Spell slots level 5 (per level)",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "default_value": []
  },
  {
    "id": "spell_slots_level_6_per_level",
    "name": "Spell slots level 6 (per level)",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "default_value": []
  },
  {
    "id": "spell_slots_level_7_per_level",
    "name": "Spell slots level 7 (per level)",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "default_value": []
  },
  {
    "id": "spell_slots_level_8_per_level",
    "name": "Spell slots level 8 (per level)",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "default_value": []
  },
  {
    "id": "spell_slots_level_9_per_level",
    "name": "Spell slots level 9 (per level)",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "default_value": []
  },
  {
    "id": "actual_recharge_slots_on_short_rest",
    "name": "Actual recharge slots on short rest",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.same_effective_caster_level_as_parent"
            },
            "default_components": {
              "type": "constant",
              "value": true,
              "value_type": "bool"
            }
          },
          "components": {
            "type": "stat",
            "stat": "recharge_slots_on_short_rest"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.recharge_slots_on_short_rest"
          }
        }
      ]
    }
  },
  {
    "id": "actual_spell_slots_level_1_per_level",
    "name": "Actual recharge slots on short rest",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.same_effective_caster_level_as_parent"
            },
            "default_components": {
              "type": "constant",
              "value": true,
              "value_type": "bool"
            }
          },
          "components": {
            "type": "stat",
            "stat": "spell_slots_level_1_per_level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.spell_slots_level_1_per_level"
          }
        }
      ]
    }
  },
  {
    "id": "actual_spell_slots_level_2_per_level",
    "name": "Actual recharge slots on short rest",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.same_effective_caster_level_as_parent"
            },
            "default_components": {
              "type": "constant",
              "value": true,
              "value_type": "bool"
            }
          },
          "components": {
            "type": "stat",
            "stat": "spell_slots_level_2_per_level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.spell_slots_level_2_per_level"
          }
        }
      ]
    }
  },
  {
    "id": "actual_spell_slots_level_3_per_level",
    "name": "Actual recharge slots on short rest",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.same_effective_caster_level_as_parent"
            },
            "default_components": {
              "type": "constant",
              "value": true,
              "value_type": "bool"
            }
          },
          "components": {
            "type": "stat",
            "stat": "spell_slots_level_3_per_level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.spell_slots_level_3_per_level"
          }
        }
      ]
    }
  },
  {
    "id": "actual_spell_slots_level_4_per_level",
    "name": "Actual recharge slots on short rest",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.same_effective_caster_level_as_parent"
            },
            "default_components": {
              "type": "constant",
              "value": true,
              "value_type": "bool"
            }
          },
          "components": {
            "type": "stat",
            "stat": "spell_slots_level_4_per_level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.spell_slots_level_4_per_level"
          }
        }
      ]
    }
  },
  {
    "id": "actual_spell_slots_level_5_per_level",
    "name": "Actual recharge slots on short rest",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.same_effective_caster_level_as_parent"
            },
            "default_components": {
              "type": "constant",
              "value": true,
              "value_type": "bool"
            }
          },
          "components": {
            "type": "stat",
            "stat": "spell_slots_level_5_per_level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.spell_slots_level_5_per_level"
          }
        }
      ]
    }
  },
  {
    "id": "actual_spell_slots_level_6_per_level",
    "name": "Actual recharge slots on short rest",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.same_effective_caster_level_as_parent"
            },
            "default_components": {
              "type": "constant",
              "value": true,
              "value_type": "bool"
            }
          },
          "components": {
            "type": "stat",
            "stat": "spell_slots_level_6_per_level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.spell_slots_level_6_per_level"
          }
        }
      ]
    }
  },
  {
    "id": "actual_spell_slots_level_7_per_level",
    "name": "Actual recharge slots on short rest",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.same_effective_caster_level_as_parent"
            },
            "default_components": {
              "type": "constant",
              "value": true,
              "value_type": "bool"
            }
          },
          "components": {
            "type": "stat",
            "stat": "spell_slots_level_7_per_level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.spell_slots_level_7_per_level"
          }
        }
      ]
    }
  },
  {
    "id": "actual_spell_slots_level_8_per_level",
    "name": "Actual recharge slots on short rest",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.same_effective_caster_level_as_parent"
            },
            "default_components": {
              "type": "constant",
              "value": true,
              "value_type": "bool"
            }
          },
          "components": {
            "type": "stat",
            "stat": "spell_slots_level_8_per_level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.spell_slots_level_8_per_level"
          }
        }
      ]
    }
  },
  {
    "id": "actual_spell_slots_level_9_per_level",
    "name": "Actual recharge slots on short rest",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.same_effective_caster_level_as_parent"
            },
            "default_components": {
              "type": "constant",
              "value": true,
              "value_type": "bool"
            }
          },
          "components": {
            "type": "stat",
            "stat": "spell_slots_level_9_per_level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype.spell_slots_level_9_per_level"
          }
        }
      ]
    }
  },
  {
    "id": "weapon",
    "name": "Weapon",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_weapon",
    "default_value": []
  },
  {
    "id": "attacks_per_action_per_level",
    "name": "Attacks per action (by lvl)",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "default_value": []
  },
  {
    "id": "language_proficiencies",
    "name": "Language proficiencies",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_choice_text",
    "default_value": []
  },
  {
    "id": "skill_proficiencies",
    "name": "Skill proficiencies",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_skill_proficiency",
    "default_value": []
  },
  {
    "id": "account_for_skill_proficiencies_on_multiclass",
    "name": "Account for skill proficiencies on multiclass",
    "type": "base",
    "value_type": "bool",
    "default_value": true
  },
  {
    "id": "armor_proficiencies",
    "name": "Armor proficiencies",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_armor_proficiency",
    "default_value": []
  },
  {
    "id": "account_for_armor_proficiencies_on_multiclass",
    "name": "Account for armor proficiencies on multiclass",
    "type": "base",
    "value_type": "bool",
    "default_value": true
  },
  {
    "id": "weapon_proficiencies",
    "name": "Weapon proficiencies",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_weapon_proficiency",
    "default_value": []
  },
  {
    "id": "account_for_weapon_proficiencies_on_multiclass",
    "name": "Account for weapon proficiencies on multiclass",
    "type": "base",
    "value_type": "bool",
    "default_value": true
  },
  {
    "id": "tool_proficiencies",
    "name": "Tool proficiencies",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_choice_text",
    "default_value": []
  },
  {
    "id": "account_for_tool_proficiencies_on_multiclass",
    "name": "Account for tool proficiencies on multiclass",
    "type": "base",
    "value_type": "bool",
    "default_value": true
  },
  {
    "id": "selectable_equipments",
    "name": "Selectable equipment",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "selectable_items",
    "default_value": []
  },
  {
    "id": "selectable_armors",
    "name": "Selectable armor",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "selectable_armors",
    "default_value": []
  },
  {
    "id": "selectable_weapons",
    "name": "Selectable weapons",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "selectable_weapons",
    "default_value": []
  },
  {
    "id": "archetype_selection_level",
    "name": "Archetype selection level",
    "type": "base",
    "value_type": "integer",
    "default_value": 3
  },
  {
    "id": "archetypes",
    "name": "Archetypes",
    "type": "base",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "class",
    "default_value": []
  },
  {
    "id": "is_archetype",
    "name": "Is archetype",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "defined",
      "stat": "$parent.archetypes"
    }
  },
  {
    "id": "archetype_names",
    "name": "Archetype names",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "joinToString",
      "separator": ", ",
      "components": {
        "type": "map",
        "components": {
          "type": "stat",
          "stat": "archetypes"
        },
        "mapper": {
          "type": "stat",
          "stat": "$mapValue.name"
        }
      }
    }
  },
  {
    "id": "current_class_details",
    "name": "Current class details",
    "type": "calculated",
    "value_type": "resource",
    "resource_type": "class_details",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "stat",
            "stat": "is_archetype"
          },
          "components": {
            "type": "stat",
            "stat": "$parent.current_class_details"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "$parent?"
          }
        }
      ]
    }
  },
  {
    "id": "selected_archetype",
    "name": "Selected archetype",
    "type": "calculated",
    "value_type": "resource",
    "resource_type": "class",
    "components": {
      "type": "findFirst",
      "components": {
        "type": "when",
        "clauses": [
          {
            "condition": {
              "type": "stat",
              "stat": "is_archetype"
            },
            "components": {
              "type": "stat",
              "stat": "$parent.archetypes"
            }
          },
          {
            "condition": {
              "type": "constant",
              "value": true,
              "value_type": "bool"
            },
            "components": {
              "type": "stat",
              "stat": "archetypes"
            }
          }
        ]
      },
      "filter": {
        "type": "equals",
        "components": {
          "type": "list",
          "components": [
            {
              "type": "stat",
              "stat": "$findFirstValue.id"
            },
            {
              "type": "stat",
              "stat": "current_class_details?.archetype_id?"
            }
          ]
        }
      }
    }
  },
  {
    "id": "current_level_weapon",
    "name": "Current level weapon",
    "type": "calculated",
    "value_type": "resource",
    "resource_type": "levelled_weapon",
    "components": {
      "type": "findFirst",
      "components": {
        "type": "sortBy",
        "order": "desc",
        "components": {
          "type": "stat",
          "stat": "weapon"
        },
        "sort_by_selector": {
          "type": "stat",
          "stat": "$sortByValue.level"
        }
      },
      "filter": {
        "type": "lessThanEquals",
        "components": {
          "type": "list",
          "components": [
            {
              "type": "stat",
              "stat": "$findFirstValue.level"
            },
            {
              "type": "stat",
              "stat": "level"
            }
          ]
        }
      }
    }
  },
  {
    "id": "selected_archetype_has_weapon",
    "name": "Selected archetype has weapon",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "notNull",
      "components": {
        "type": "stat",
        "stat": "selected_archetype?.current_level_weapon"
      }
    }
  },
  {
    "id": "should_load_effects",
    "name": "Should load effects",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "not",
            "components": {
              "type": "stat",
              "stat": "is_archetype"
            }
          },
          {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "selected_archetype?.id"
                },
                {
                  "type": "stat",
                  "stat": "id"
                }
              ]
            }
          }
        ]
      }
    }
  },
  {
    "id": "weapons",
    "name": "Weapons",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "weapon",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "stat",
            "stat": "selected_archetype_has_weapon"
          },
          "components": {
            "type": "list",
            "components": [
              {
                "type": "stat",
                "stat": "selected_archetype.current_level_weapon.weapon"
              }
            ]
          }
        },
        {
          "condition": {
            "type": "notNull",
            "components": {
              "type": "stat",
              "stat": "current_level_weapon"
            }
          },
          "components": {
            "type": "list",
            "components": [
              {
                "type": "stat",
                "stat": "current_level_weapon.weapon"
              }
            ]
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "list",
            "components": []
          }
        }
      ]
    }
  },
  {
    "id": "should_ask_for_effective_caster_level",
    "name": "Should ask for effective caster level",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "not",
            "components": {
              "type": "stat",
              "stat": "is_archetype"
            }
          },
          {
            "type": "not",
            "components": {
              "type": "defaultIfNull",
              "components": {
                "type": "stat",
                "stat": "$view?.class_edit_has_same_effective_caster_level?"
              },
              "default_components": {
                "type": "constant",
                "value": false,
                "value_type": "bool"
              }
            }
          }
        ]
      }
    }
  },
  {
    "id": "should_fill_custom_spell_slots",
    "name": "Should fill custom spell slots",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "and",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "$view?.class_edit_effective_caster_level?"
                },
                {
                  "type": "constant",
                  "value": "custom",
                  "value_type": "string"
                }
              ]
            }
          },
          {
            "type": "stat",
            "stat": "should_ask_for_effective_caster_level"
          }
        ]
      }
    }
  },
  {
    "id": "attacks_per_action_text",
    "name": "Attacks per action text",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "stat",
            "stat": "is_archetype"
          },
          "components": {
            "type": "constant",
            "value": "Override attacks per action (by lvl): ",
            "value_type": "string"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "constant",
            "value": "Attacks per action (by lvl): ",
            "value_type": "string"
          }
        }
      ]
    }
  },
  {
    "id": "saving_throws_text",
    "name": "Saving throws text",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "stat",
            "stat": "is_archetype"
          },
          "components": {
            "type": "constant",
            "value": "Additional saving throws:",
            "value_type": "string"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "constant",
            "value": "Saving throws:",
            "value_type": "string"
          }
        }
      ]
    }
  },
  {
    "id": "level",
    "name": "Current class level",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "defaultIfNull",
      "components": {
        "type": "stat",
        "stat": "current_class_details?.class_level?"
      },
      "default_components": {
        "type": "constant",
        "value": 1,
        "value_type": "integer"
      }
    }
  },
  {
    "id": "language_proficiencies_for_current_level",
    "name": "Language proficiencies for current level",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_choice_text",
    "components": {
      "type": "flatAppend",
      "components": [
        {
          "type": "filter",
          "components": {
            "type": "stat",
            "stat": "language_proficiencies"
          },
          "filter": {
            "type": "lessThanEquals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "$filterValue.level"
                },
                {
                  "type": "stat",
                  "stat": "level"
                }
              ]
            }
          }
        },
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "not",
                "components": {
                  "type": "stat",
                  "stat": "is_archetype"
                }
              },
              "components": {
                "type": "defaultIfNull",
                "components": {
                  "type": "stat",
                  "stat": "selected_archetype?.language_proficiencies_for_current_level"
                },
                "default_components": {
                  "type": "list",
                  "components": []
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        }
      ]
    }
  },
  {
    "id": "skill_proficiencies_for_current_level",
    "name": "Skill proficiencies for current level",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_skill_proficiency",
    "components": {
      "type": "flatAppend",
      "components": [
        {
          "type": "filter",
          "components": {
            "type": "stat",
            "stat": "skill_proficiencies"
          },
          "filter": {
            "type": "lessThanEquals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "$filterValue.level"
                },
                {
                  "type": "stat",
                  "stat": "level"
                }
              ]
            }
          }
        },
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "not",
                "components": {
                  "type": "stat",
                  "stat": "is_archetype"
                }
              },
              "components": {
                "type": "defaultIfNull",
                "components": {
                  "type": "stat",
                  "stat": "selected_archetype?.skill_proficiencies_for_current_level"
                },
                "default_components": {
                  "type": "list",
                  "components": []
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        }
      ]
    }
  },
  {
    "id": "armor_proficiencies_for_current_level",
    "name": "Armor proficiencies for current level",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_armor_proficiency",
    "components": {
      "type": "flatAppend",
      "components": [
        {
          "type": "filter",
          "components": {
            "type": "stat",
            "stat": "armor_proficiencies"
          },
          "filter": {
            "type": "lessThanEquals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "$filterValue.level"
                },
                {
                  "type": "stat",
                  "stat": "level"
                }
              ]
            }
          }
        },
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "not",
                "components": {
                  "type": "stat",
                  "stat": "is_archetype"
                }
              },
              "components": {
                "type": "defaultIfNull",
                "components": {
                  "type": "stat",
                  "stat": "selected_archetype?.armor_proficiencies_for_current_level"
                },
                "default_components": {
                  "type": "list",
                  "components": []
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        }
      ]
    }
  },
  {
    "id": "weapon_proficiencies_for_current_level",
    "name": "Weapon proficiencies for current level",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_weapon_proficiency",
    "components": {
      "type": "flatAppend",
      "components": [
        {
          "type": "filter",
          "components": {
            "type": "stat",
            "stat": "weapon_proficiencies"
          },
          "filter": {
            "type": "lessThanEquals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "$filterValue.level"
                },
                {
                  "type": "stat",
                  "stat": "level"
                }
              ]
            }
          }
        },
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "not",
                "components": {
                  "type": "stat",
                  "stat": "is_archetype"
                }
              },
              "components": {
                "type": "defaultIfNull",
                "components": {
                  "type": "stat",
                  "stat": "selected_archetype?.weapon_proficiencies_for_current_level"
                },
                "default_components": {
                  "type": "list",
                  "components": []
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        }
      ]
    }
  },
  {
    "id": "tool_proficiencies_for_current_level",
    "name": "Tool proficiencies for current level",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_choice_text",
    "components": {
      "type": "flatAppend",
      "components": [
        {
          "type": "filter",
          "components": {
            "type": "stat",
            "stat": "tool_proficiencies"
          },
          "filter": {
            "type": "lessThanEquals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "$filterValue.level"
                },
                {
                  "type": "stat",
                  "stat": "level"
                }
              ]
            }
          }
        },
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "not",
                "components": {
                  "type": "stat",
                  "stat": "is_archetype"
                }
              },
              "components": {
                "type": "defaultIfNull",
                "components": {
                  "type": "stat",
                  "stat": "selected_archetype?.tool_proficiencies_for_current_level"
                },
                "default_components": {
                  "type": "list",
                  "components": []
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        }
      ]
    }
  },
  {
    "id": "is_primary_class",
    "name": "Is primary class",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "defined",
            "stat": "$character"
          },
          "components": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "findFirst",
                  "components": {
                    "type": "map",
                    "components": {
                      "type": "stat",
                      "stat": "$character.classes"
                    },
                    "mapper": {
                      "type": "stat",
                      "stat": "$mapValue.class.id"
                    }
                  },
                  "filter": {
                    "type": "constant",
                    "value": true,
                    "value_type": "bool"
                  }
                },
                {
                  "type": "stat",
                  "stat": "id"
                }
              ]
            }
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "constant",
            "value": false,
            "value_type": "bool"
          }
        }
      ]
    }
  },
  {
    "id": "language_proficiencies_choices_in_current_level",
    "name": "Language proficiencies choices in current level",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_choice_text",
    "components": {
      "type": "flatAppend",
      "components": [
        {
          "type": "filter",
          "components": {
            "type": "stat",
            "stat": "language_proficiencies"
          },
          "filter": {
            "type": "equals",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "$filterValue.level"
                },
                {
                  "type": "stat",
                  "stat": "level"
                }
              ]
            }
          }
        },
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "not",
                "components": {
                  "type": "stat",
                  "stat": "is_archetype"
                }
              },
              "components": {
                "type": "defaultIfNull",
                "components": {
                  "type": "stat",
                  "stat": "selected_archetype?.language_proficiencies_choices_in_current_level"
                },
                "default_components": {
                  "type": "list",
                  "components": []
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        }
      ]
    }
  },
  {
    "id": "skill_proficiencies_choices_in_current_level",
    "name": "Skill proficiencies choices in current level",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_skill_proficiency",
    "components": {
      "type": "flatAppend",
      "components": [
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "or",
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "stat",
                      "stat": "is_primary_class"
                    },
                    {
                      "type": "stat",
                      "stat": "account_for_skill_proficiencies_on_multiclass"
                    }
                  ]
                }
              },
              "components": {
                "type": "filter",
                "components": {
                  "type": "stat",
                  "stat": "skill_proficiencies"
                },
                "filter": {
                  "type": "equals",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "stat",
                        "stat": "$filterValue.level"
                      },
                      {
                        "type": "stat",
                        "stat": "level"
                      }
                    ]
                  }
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        },
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "not",
                "components": {
                  "type": "stat",
                  "stat": "is_archetype"
                }
              },
              "components": {
                "type": "defaultIfNull",
                "components": {
                  "type": "stat",
                  "stat": "selected_archetype?.skill_proficiencies_choices_in_current_level"
                },
                "default_components": {
                  "type": "list",
                  "components": []
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        }
      ]
    }
  },
  {
    "id": "armor_proficiencies_choices_in_current_level",
    "name": "Armor proficiencies choices in current level",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_armor_proficiency",
    "components": {
      "type": "flatAppend",
      "components": [
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "or",
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "stat",
                      "stat": "is_primary_class"
                    },
                    {
                      "type": "stat",
                      "stat": "account_for_armor_proficiencies_on_multiclass"
                    }
                  ]
                }
              },
              "components": {
                "type": "filter",
                "components": {
                  "type": "stat",
                  "stat": "armor_proficiencies"
                },
                "filter": {
                  "type": "equals",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "stat",
                        "stat": "$filterValue.level"
                      },
                      {
                        "type": "stat",
                        "stat": "level"
                      }
                    ]
                  }
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        },
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "not",
                "components": {
                  "type": "stat",
                  "stat": "is_archetype"
                }
              },
              "components": {
                "type": "defaultIfNull",
                "components": {
                  "type": "stat",
                  "stat": "selected_archetype?.armor_proficiencies_choices_in_current_level"
                },
                "default_components": {
                  "type": "list",
                  "components": []
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        }
      ]
    }
  },
  {
    "id": "weapon_proficiencies_choices_in_current_level",
    "name": "Weapon proficiencies choices in current level",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_weapon_proficiency",
    "components": {
      "type": "flatAppend",
      "components": [
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "or",
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "stat",
                      "stat": "is_primary_class"
                    },
                    {
                      "type": "stat",
                      "stat": "account_for_weapon_proficiencies_on_multiclass"
                    }
                  ]
                }
              },
              "components": {
                "type": "filter",
                "components": {
                  "type": "stat",
                  "stat": "weapon_proficiencies"
                },
                "filter": {
                  "type": "equals",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "stat",
                        "stat": "$filterValue.level"
                      },
                      {
                        "type": "stat",
                        "stat": "level"
                      }
                    ]
                  }
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        },
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "not",
                "components": {
                  "type": "stat",
                  "stat": "is_archetype"
                }
              },
              "components": {
                "type": "defaultIfNull",
                "components": {
                  "type": "stat",
                  "stat": "selected_archetype?.weapon_proficiencies_choices_in_current_level"
                },
                "default_components": {
                  "type": "list",
                  "components": []
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        }
      ]
    }
  },
  {
    "id": "tool_proficiencies_choices_in_current_level",
    "name": "Tool proficiencies choices in current level",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_choice_text",
    "components": {
      "type": "flatAppend",
      "components": [
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "or",
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "stat",
                      "stat": "is_primary_class"
                    },
                    {
                      "type": "stat",
                      "stat": "account_for_tool_proficiencies_on_multiclass"
                    }
                  ]
                }
              },
              "components": {
                "type": "filter",
                "components": {
                  "type": "stat",
                  "stat": "tool_proficiencies"
                },
                "filter": {
                  "type": "equals",
                  "components": {
                    "type": "list",
                    "components": [
                      {
                        "type": "stat",
                        "stat": "$filterValue.level"
                      },
                      {
                        "type": "stat",
                        "stat": "level"
                      }
                    ]
                  }
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        },
        {
          "type": "when",
          "clauses": [
            {
              "condition": {
                "type": "not",
                "components": {
                  "type": "stat",
                  "stat": "is_archetype"
                }
              },
              "components": {
                "type": "defaultIfNull",
                "components": {
                  "type": "stat",
                  "stat": "selected_archetype?.tool_proficiencies_choices_in_current_level"
                },
                "default_components": {
                  "type": "list",
                  "components": []
                }
              }
            },
            {
              "condition": {
                "type": "constant",
                "value": true,
                "value_type": "bool"
              },
              "components": {
                "type": "list",
                "components": []
              }
            }
          ]
        }
      ]
    }
  },
  {
    "id": "actual_attacks_per_action_per_level",
    "name": "Actual attacks per action per level",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "levelled_amount",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "not",
                  "components": {
                    "type": "isEmpty",
                    "components": {
                      "type": "defaultIfNull",
                      "components": {
                        "type": "stat",
                        "stat": "selected_archetype?.attacks_per_action_per_level"
                      },
                      "default_components": {
                        "type": "list",
                        "components": []
                      }
                    }
                  }
                }
              ]
            }
          },
          "components": {
            "type": "stat",
            "stat": "selected_archetype?.attacks_per_action_per_level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "attacks_per_action_per_level"
          }
        }
      ]
    }
  },
  {
    "id": "current_level_attacks_per_action",
    "name": "Current level attacks per action resource",
    "type": "calculated",
    "value_type": "resource",
    "resource_type": "levelled_amount",
    "components": {
      "type": "findFirst",
      "components": {
        "type": "sortBy",
        "order": "desc",
        "components": {
          "type": "stat",
          "stat": "actual_attacks_per_action_per_level"
        },
        "sort_by_selector": {
          "type": "stat",
          "stat": "$sortByValue.level"
        }
      },
      "filter": {
        "type": "lessThanEquals",
        "components": {
          "type": "list",
          "components": [
            {
              "type": "stat",
              "stat": "$findFirstValue.level"
            },
            {
              "type": "stat",
              "stat": "level"
            }
          ]
        }
      }
    }
  },
  {
    "id": "attacks_per_action_number_for_current_level",
    "name": "Attacks per action for current level",
    "type": "calculated",
    "value_type": "integer",
    "components": {
      "type": "defaultIfNull",
      "components": {
        "type": "stat",
        "stat": "current_level_attacks_per_action?.amount"
      },
      "default_components": {
        "type": "constant",
        "value": 1,
        "value_type": "integer"
      }
    }
  },
  {
    "id": "has_strength_saving_throw_proficiency",
    "name": "Has strength saving throw proficiency",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.strength_saving_throw_proficiency"
            },
            "default_components": {
              "type": "constant",
              "value": false,
              "value_type": "bool"
            }
          },
          {
            "type": "stat",
            "stat": "strength_saving_throw_proficiency"
          }
        ]
      }
    }
  },
  {
    "id": "has_dexterity_saving_throw_proficiency",
    "name": "Has dexterity saving throw proficiency",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.dexterity_saving_throw_proficiency"
            },
            "default_components": {
              "type": "constant",
              "value": false,
              "value_type": "bool"
            }
          },
          {
            "type": "stat",
            "stat": "dexterity_saving_throw_proficiency"
          }
        ]
      }
    }
  },
  {
    "id": "has_constitution_saving_throw_proficiency",
    "name": "Has constitution saving throw proficiency",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.constitution_saving_throw_proficiency"
            },
            "default_components": {
              "type": "constant",
              "value": false,
              "value_type": "bool"
            }
          },
          {
            "type": "stat",
            "stat": "constitution_saving_throw_proficiency"
          }
        ]
      }
    }
  },
  {
    "id": "has_intelligence_saving_throw_proficiency",
    "name": "Has intelligence saving throw proficiency",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.intelligence_saving_throw_proficiency"
            },
            "default_components": {
              "type": "constant",
              "value": false,
              "value_type": "bool"
            }
          },
          {
            "type": "stat",
            "stat": "intelligence_saving_throw_proficiency"
          }
        ]
      }
    }
  },
  {
    "id": "has_wisdom_saving_throw_proficiency",
    "name": "Has wisdom saving throw proficiency",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.wisdom_saving_throw_proficiency"
            },
            "default_components": {
              "type": "constant",
              "value": false,
              "value_type": "bool"
            }
          },
          {
            "type": "stat",
            "stat": "wisdom_saving_throw_proficiency"
          }
        ]
      }
    }
  },
  {
    "id": "has_charisma_saving_throw_proficiency",
    "name": "Has charisma saving throw proficiency",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.charisma_saving_throw_proficiency"
            },
            "default_components": {
              "type": "constant",
              "value": false,
              "value_type": "bool"
            }
          },
          {
            "type": "stat",
            "stat": "charisma_saving_throw_proficiency"
          }
        ]
      }
    }
  },
  {
    "id": "selected_selectable_feature_ids",
    "name": "Selected selectable feature ids",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "string",
    "components": {
      "type": "defaultIfNull",
      "components": {
        "type": "stat",
        "stat": "current_class_details?.selected_selectable_feature_ids?"
      },
      "default_components": {
        "type": "list",
        "components": []
      }
    }
  },
  {
    "id": "all_features",
    "name": "All features",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "feat",
    "components": {
      "type": "flatMap",
      "components": {
        "type": "flatAppend",
        "components": [
          {
            "type": "stat",
            "stat": "features"
          },
          {
            "type": "defaultIfNull",
            "components": {
              "type": "stat",
              "stat": "selected_archetype?.features"
            },
            "default_components": {
              "type": "list",
              "components": []
            }
          }
        ]
      },
      "mapper": {
        "type": "flatAppend",
        "components": [
          {
            "type": "list",
            "components": [
              {
                "type": "stat",
                "stat": "$mapValue"
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "stat",
                  "stat": "$mapValue.has_selectable_features"
                },
                "components": {
                  "type": "filter",
                  "components": {
                    "type": "stat",
                    "stat": "$mapValue.selectable_features"
                  },
                  "filter": {
                    "type": "contains",
                    "haystack": {
                      "type": "stat",
                      "stat": "selected_selectable_feature_ids"
                    },
                    "needle": {
                      "type": "stat",
                      "stat": "$filterValue.id"
                    }
                  }
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "id": "current_level_features",
    "name": "Current level features",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "feat",
    "components": {
      "type": "filter",
      "components": {
        "type": "stat",
        "stat": "all_features"
      },
      "filter": {
        "type": "lessThanEquals",
        "components": {
          "type": "list",
          "components": [
            {
              "type": "stat",
              "stat": "$filterValue.min_level"
            },
            {
              "type": "stat",
              "stat": "level"
            }
          ]
        }
      }
    }
  },
  {
    "id": "features_with_updates_in_current_level",
    "name": "Features with updates in current level",
    "type": "calculated",
    "value_type": "array",
    "sub_value_type": "resource",
    "resource_type": "feat",
    "components": {
      "type": "filter",
      "components": {
        "type": "stat",
        "stat": "all_features"
      },
      "filter_value_key": "$feat",
      "filter": {
        "type": "not",
        "components": {
          "type": "isEmpty",
          "components": {
            "type": "filter",
            "components": {
              "type": "stat",
              "stat": "$feat.descriptions"
            },
            "filter": {
              "type": "equals",
              "components": {
                "type": "list",
                "components": [
                  {
                    "type": "stat",
                    "stat": "$filterValue.level"
                  },
                  {
                    "type": "stat",
                    "stat": "level"
                  }
                ]
              }
            }
          }
        }
      }
    }
  },
  {
    "id": "display_hp",
    "name": "Display hp",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "is_archetype"
                },
                {
                  "type": "stat",
                  "stat": "same_hp_as_parent"
                }
              ]
            }
          },
          "components": {
            "type": "stat",
            "stat": "$parent.display_hp"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "joinToString",
            "separator": " + ",
            "components": {
              "type": "flatAppend",
              "components": [
                {
                  "type": "list",
                  "components": [
                    {
                      "type": "concat",
                      "components": {
                        "type": "list",
                        "components": [
                          {
                            "type": "constant",
                            "value": "1",
                            "value_type": "string"
                          },
                          {
                            "type": "stat",
                            "stat": "actual_hit_die"
                          }
                        ]
                      }
                    }
                  ]
                },
                {
                  "type": "stat",
                  "stat": "actual_hp_modifiers"
                }
              ]
            }
          }
        }
      ]
    }
  },
  {
    "id": "display_armor_class",
    "name": "Display armor class",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "is_archetype"
                },
                {
                  "type": "stat",
                  "stat": "same_ac_as_parent"
                }
              ]
            }
          },
          "components": {
            "type": "stat",
            "stat": "$parent.display_armor_class"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "joinToString",
            "separator": " + ",
            "components": {
              "type": "flatAppend",
              "components": [
                {
                  "type": "list",
                  "components": [
                    {
                      "type": "stat",
                      "stat": "base_ac"
                    }
                  ]
                },
                {
                  "type": "stat",
                  "stat": "ac_modifiers"
                }
              ]
            }
          }
        }
      ]
    }
  },
  {
    "id": "display_saving_throws",
    "name": "Display saving throws",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "joinToString",
      "separator": ", ",
      "components": {
        "type": "flatAppend",
        "components": [
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "stat",
                  "stat": "strength_saving_throw_proficiency"
                },
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "constant",
                      "value": "strength",
                      "value_type": "string"
                    }
                  ]
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "stat",
                  "stat": "dexterity_saving_throw_proficiency"
                },
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "constant",
                      "value": "dexterity",
                      "value_type": "string"
                    }
                  ]
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "stat",
                  "stat": "constitution_saving_throw_proficiency"
                },
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "constant",
                      "value": "constitution",
                      "value_type": "string"
                    }
                  ]
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "stat",
                  "stat": "intelligence_saving_throw_proficiency"
                },
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "constant",
                      "value": "intelligence",
                      "value_type": "string"
                    }
                  ]
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "stat",
                  "stat": "wisdom_saving_throw_proficiency"
                },
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "constant",
                      "value": "wisdom",
                      "value_type": "string"
                    }
                  ]
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              }
            ]
          },
          {
            "type": "when",
            "clauses": [
              {
                "condition": {
                  "type": "stat",
                  "stat": "charisma_saving_throw_proficiency"
                },
                "components": {
                  "type": "list",
                  "components": [
                    {
                      "type": "constant",
                      "value": "charisma",
                      "value_type": "string"
                    }
                  ]
                }
              },
              {
                "condition": {
                  "type": "constant",
                  "value": true,
                  "value_type": "bool"
                },
                "components": {
                  "type": "list",
                  "components": []
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "id": "display_spellcasting_ability",
    "name": "Display spellcasting ability",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "is_archetype"
                },
                {
                  "type": "stat",
                  "stat": "same_spellcasting_ability_as_parent"
                }
              ]
            }
          },
          "components": {
            "type": "stat",
            "stat": "$parent.display_spellcasting_ability"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "stat",
            "stat": "spellcasting_ability"
          }
        }
      ]
    }
  },
  {
    "id": "display_caster_level",
    "name": "Display caster level",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "and",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "is_archetype"
                },
                {
                  "type": "stat",
                  "stat": "same_effective_caster_level_as_parent"
                }
              ]
            }
          },
          "components": {
            "type": "stat",
            "stat": "$parent.display_caster_level"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "enumeratedName",
            "enumerated_type": "effective_caster_level_types",
            "id": {
              "type": "stat",
              "stat": "effective_caster_level"
            }
          }
        }
      ]
    }
  },
  {
    "id": "lowest_level_weapon",
    "name": "Lowest level weapon",
    "type": "calculated",
    "value_type": "resource",
    "components": {
      "type": "findFirst",
      "components": {
        "type": "sortBy",
        "order": "asc",
        "components": {
          "type": "stat",
          "stat": "weapon"
        },
        "sort_by_selector": {
          "type": "stat",
          "stat": "$sortByValue.level"
        }
      },
      "filter": {
        "type": "constant",
        "value": true,
        "value_type": "bool"
      }
    }
  },
  {
    "id": "display_weapon",
    "name": "Display weapon",
    "type": "calculated",
    "value_type": "string",
    "components": {
      "type": "when",
      "clauses": [
        {
          "condition": {
            "type": "isEmpty",
            "components": {
              "type": "stat",
              "stat": "weapon"
            }
          },
          "components": {
            "type": "constant",
            "value": "None",
            "value_type": "string"
          }
        },
        {
          "condition": {
            "type": "constant",
            "value": true,
            "value_type": "bool"
          },
          "components": {
            "type": "concat",
            "components": {
              "type": "list",
              "components": [
                {
                  "type": "stat",
                  "stat": "lowest_level_weapon.weapon.name"
                },
                {
                  "type": "constant",
                  "value": ", ",
                  "value_type": "string"
                },
                {
                  "type": "stat",
                  "stat": "lowest_level_weapon.weapon.damage_dice_display_description"
                },
                {
                  "type": "constant",
                  "value": " + ",
                  "value_type": "string"
                },
                {
                  "type": "stat",
                  "stat": "lowest_level_weapon.weapon.attack_ability"
                }
              ]
            }
          }
        }
      ]
    }
  },
  {
    "id": "feat_show_level",
    "name": "Show feat level",
    "type": "calculated",
    "value_type": "bool",
    "components": {
      "type": "or",
      "components": {
        "type": "list",
        "components": [
          {
            "type": "not",
            "components": {
              "type": "defined",
              "stat": "$character"
            }
          },
          {
            "type": "defined",
            "stat": "$character.$is_new"
          }
        ]
      }
    }
  }
]